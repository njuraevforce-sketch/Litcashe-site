<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LC ‚Ä¢ Admin</title>
  <link rel="icon" href="data:,">
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <style>
    :root{
      --bg:#f7f8fa; --panel:#ffffff; --text:#17223b; --muted:#6b7280; --accent:#2563eb;
      --ok:#10b981; --warn:#eab308; --bad:#ef4444; --line:#e5e7eb; --chip:#f3f4f6;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font:14px/1.45 Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:1280px;margin:0 auto;padding:18px}
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{font-weight:800;font-size:18px;letter-spacing:.2px}
    .authbar{display:flex;gap:8px;align-items:center}
    .muted{color:var(--muted)}
    .btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 12px;cursor:pointer;transition:.15s}
    .btn:hover{box-shadow:0 1px 0 rgba(0,0,0,.05)}
    .btn.ok{background:#ecfdf5;border-color:#d1fae5}
    .btn.warn{background:#fffbeb;border-color:#fef3c7}
    .btn.bad{background:#fef2f2;border-color:#fee2e2}
    .btn.ghost{background:#fff}
    .btn.small{padding:5px 8px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 14px}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer}
    .tab.active{background:#e8f0ff;border-color:#c7d2fe;color:#1e40af}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;margin-bottom:14px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .grow{flex:1}
    input,select,textarea{background:#fff;border:1px solid var(--line);border-radius:10px;padding:8px 10px;outline:none}
    input:focus,select:focus,textarea:focus{border-color:#93c5fd;box-shadow:0 0 0 3px rgba(59,130,246,.15)}
    .table-wrap{overflow:auto;border:1px solid var(--line);border-radius:12px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    thead th{background:#f9fafb;border-bottom:1px solid var(--line);padding:10px;text-align:left;white-space:nowrap}
    td{border-top:1px solid var(--line);padding:10px;vertical-align:top}
    .right{text-align:right}
    .chip{display:inline-block;background:var(--chip);border:1px solid var(--line);padding:3px 8px;border-radius:999px;font-size:12px}
    .pill{padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line)}
    .pill.paid{background:#ecfdf5;border-color:#d1fae5;color:#065f46}
    .pill.pending{background:#eff6ff;border-color:#dbeafe;color:#1e40af}
    .pill.rejected{background:#fef2f2;border-color:#fee2e2;color:#991b1b}
    .cards{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;margin-bottom:10px}
    .card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px}
    .card .k{font-size:12px;color:var(--muted)}
    .card .v{font-weight:700;font-size:16px}
    .small{font-size:12px}
    .nowrap{white-space:nowrap}
    h3{margin:6px 0 8px}
    .hidden{display:none !important}
    .limited-only{display:none}
    .limited-admin .limited-only{display:block}
    .limited-admin .super-only{display:none !important}
    @media (max-width:900px){ .cards{grid-template-columns:repeat(2,minmax(0,1fr));} }
  </style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="brand">LC ‚Ä¢ Admin</div>
    <div class="authbar">
      <span class="muted small">–ê–∫–∫–∞—É–Ω—Ç:</span>
      <span id="authInfo" class="nowrap">‚Äî</span>
      <button class="btn" id="btnLogin">–í–æ–π—Ç–∏</button>
      <button class="btn" id="btnLogout" style="display:none">–í—ã–π—Ç–∏</button>
    </div>
  </div>

  <!-- LIMITED ADMIN STATS -->
  <div id="limitedStats" class="limited-only panel">
    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–∏—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</h3>
    <div class="cards">
      <div class="card"><div class="k">–í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</div><div id="lTotalUsers" class="v">‚Äî</div></div>
      <div class="card"><div class="k">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div><div id="lTotalBalance" class="v">‚Äî</div></div>
      <div class="card"><div class="k">L1 –±–∞–ª–∞–Ω—Å</div><div id="lL1Balance" class="v">‚Äî</div></div>
      <div class="card"><div class="k">L2 –±–∞–ª–∞–Ω—Å</div><div id="lL2Balance" class="v">‚Äî</div></div>
    </div>
  </div>

  <div class="tabs" id="tabs">
    <button class="tab active" data-tab="withdrawals">–ó–∞—è–≤–∫–∏</button>
    <button class="tab" data-tab="users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
    <button class="tab" data-tab="refs">–†–µ—Ñ–µ—Ä–∞–ª—ã</button>
    <button class="tab" data-tab="rewards">–ù–∞—á–∏—Å–ª–µ–Ω–∏—è</button>
    <button class="tab" data-tab="deposits">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è</button>
    <button class="tab" data-tab="about">–°–ø—Ä–∞–≤–∫–∞</button>
  </div>

  <!-- WITHDRAWALS -->
  <section class="panel" data-page="withdrawals">
    <div class="cards">
      <div class="card"><div class="k">–í—Å–µ–≥–æ (–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ)</div><div id="wCount" class="v">‚Äî</div></div>
      <div class="card"><div class="k">–°—É–º–º–∞ –∑–∞—è–≤–æ–∫</div><div id="wSum" class="v">‚Äî</div></div>
      <div class="card"><div class="k">–ö–æ–º–∏—Å—Å–∏–∏</div><div id="wFee" class="v">‚Äî</div></div>
      <div class="card"><div class="k">–ò—Ç–æ–≥–æ –∫ –≤—ã–ø–ª–∞—Ç–µ</div><div id="wTotal" class="v">‚Äî</div></div>
    </div>

    <div class="row">
      <button class="btn" id="wReload">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>

    <div class="table-wrap" style="margin-top:8px">
      <table id="wTable">
        <thead><tr>
          <th>ID</th><th>–°–æ–∑–¥–∞–Ω–æ</th><th>Email</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
          <th class="right">–°—É–º–º–∞</th><th class="right">–ö–æ–º–∏—Å—Å–∏—è</th><th class="right">–ò—Ç–æ–≥–æ</th>
          <th>–°–µ—Ç—å</th><th>–ê–¥—Ä–µ—Å</th><th>–°—Ç–∞—Ç—É—Å</th><th>TX/–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th><th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- USERS -->
  <section class="panel" data-page="users" style="display:none">
    <div class="cards">
      <div class="card"><div class="k">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div><div id="uCount" class="v">‚Äî</div></div>
      <div class="card"><div class="k">–°—É–º–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤</div><div id="uSumBal" class="v">‚Äî</div></div>
    </div>
    <div class="row">
      <button class="btn" id="uReload">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    <div class="table-wrap" style="margin-top:8px">
      <table id="uTable">
        <thead><tr>
          <th>ID</th><th>–°–æ–∑–¥–∞–Ω–æ</th><th>Email</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
          <th class="right">–ë–∞–ª–∞–Ω—Å</th><th>–†–µ—Ñ-–∫–æ–¥</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- REFS -->
  <section class="panel" data-page="refs" style="display:none">
    <!-- LIMITED ADMIN VIEW -->
    <div class="limited-only">
      <h3>üë• –ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã (–≤—Å–µ –ø–æ–∫–æ–ª–µ–Ω–∏—è)</h3>
      <div class="table-wrap" style="margin-top:8px">
        <table id="limitedRefsTable">
          <thead><tr>
            <th>–£—Ä–æ–≤–µ–Ω—å</th><th>User ID</th><th>Email</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th class="right">–ë–∞–ª–∞–Ω—Å</th><th>–†–µ—Ñ-–∫–æ–¥</th><th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="row" style="margin-top:12px; justify-content: flex-end;">
        <button class="btn ghost" id="limitedExport">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
      </div>
    </div>

    <!-- SUPER ADMIN VIEW -->
    <div class="super-only">
      <div class="row">
        <button class="btn" id="rLoadL1">–ü–æ–∫–∞–∑–∞—Ç—å L1</button>
      </div>
      <div class="table-wrap" style="margin-top:8px">
        <table id="rL1Table">
          <thead><tr><th>User ID</th><th>Email</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th class="right">–ë–∞–ª–∞–Ω—Å</th><th>–†–µ—Ñ-–∫–æ–¥</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- REWARDS -->
  <section class="panel" data-page="rewards" style="display:none">
    <div class="table-wrap">
      <table id="rwTable">
        <thead><tr>
          <th>–î–∞—Ç–∞</th><th>–£—Ä–æ–≤–µ–Ω—å</th><th>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</th><th>–ò—Å—Ç–æ—á–Ω–∏–∫</th><th class="right">–°—É–º–º–∞</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- DEPOSITS -->
  <section class="panel" data-page="deposits" style="display:none">
    <div class="table-wrap">
      <table id="dTable">
        <thead><tr>
          <th>–î–∞—Ç–∞</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th class="right">–°—É–º–º–∞</th><th>TX</th><th>–°—Ç–∞—Ç—É—Å</th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- ABOUT -->
  <section class="panel" data-page="about" style="display:none">
    <h3>–°–ø—Ä–∞–≤–∫–∞</h3>
    <p class="small muted">
      Limited Admin: –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤. Super Admin: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø.
    </p>
  </section>
</div>

<script>
// –ü—Ä–æ—Å—Ç–µ–π—à–∏–π —Ä–∞–±–æ—á–∏–π –∫–æ–¥ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded');
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
  var sb = window.sb;
  if (!sb) {
    console.error('Supabase not loaded');
    return;
  }

  // –ü—Ä–æ—Å—Ç–µ–π—à–∞—è –∫–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞
  document.getElementById('btnLogin').addEventListener('click', function() {
    var email = prompt('Email:');
    if (!email) return;
    var password = prompt('–ü–∞—Ä–æ–ª—å:');
    if (!password) return;
    
    sb.auth.signInWithPassword({ 
      email: email, 
      password: password 
    }).then(function(result) {
      if (result.error) {
        alert('–û—à–∏–±–∫–∞: ' + result.error.message);
      } else {
        location.reload();
      }
    });
  });

  // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
  document.getElementById('btnLogout').addEventListener('click', function() {
    sb.auth.signOut().then(function() {
      location.reload();
    });
  });

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
  sb.auth.getSession().then(function({ data: { session } }) {
    if (session) {
      document.getElementById('btnLogin').style.display = 'none';
      document.getElementById('btnLogout').style.display = 'inline-block';
      document.getElementById('authInfo').textContent = session.user.email || '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∏–ø –∞–¥–º–∏–Ω–∞
      loadAdminType(session.user.id);
    }
  }).catch(function(error) {
    console.error('Session error:', error);
  });

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–∞ –∞–¥–º–∏–Ω–∞
  function loadAdminType(userId) {
    sb.from('admins').select('admin_type, ref_code').eq('user_id', userId).maybeSingle()
      .then(function({ data, error }) {
        if (error || !data) {
          console.log('Not an admin or error:', error);
          return;
        }
        
        if (data.admin_type === 'limited') {
          setupLimitedAdmin(data.ref_code);
        } else {
          setupSuperAdmin();
        }
      });
  }

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Limited Admin
  function setupLimitedAdmin(refCode) {
    console.log('Setting up limited admin with ref:', refCode);
    document.body.classList.add('limited-admin');
    document.getElementById('authInfo').textContent = 'Limited Admin (' + refCode + ')';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
    var tabs = document.querySelectorAll('#tabs .tab');
    tabs.forEach(function(tab) {
      if (tab.dataset.tab !== 'refs') {
        tab.style.display = 'none';
      }
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
    document.querySelector('[data-tab="refs"]').click();
    loadLimitedReferrals(refCode);
  }

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Super Admin
  function setupSuperAdmin() {
    console.log('Setting up super admin');
    document.getElementById('authInfo').textContent = 'Super Admin';
    
    // –í–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–∏
    var tabs = document.querySelectorAll('#tabs .tab');
    tabs.forEach(function(tab) {
      tab.addEventListener('click', function() {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö
        tabs.forEach(function(t) { t.classList.remove('active'); });
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–º—É
        this.classList.add('active');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        var tabName = this.dataset.tab;
        var pages = document.querySelectorAll('[data-page]');
        pages.forEach(function(page) {
          page.style.display = page.dataset.page === tabName ? 'block' : 'none';
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
        if (tabName === 'withdrawals') loadWithdrawals();
        if (tabName === 'users') loadUsers();
      });
    });
    
    // –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫
    document.getElementById('wReload').addEventListener('click', loadWithdrawals);
    document.getElementById('uReload').addEventListener('click', loadUsers);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    loadWithdrawals();
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –¥–ª—è Limited Admin
  function loadLimitedReferrals(refCode) {
    var tbody = document.getElementById('limitedRefsTable').querySelector('tbody');
    tbody.innerHTML = '<tr><td colspan="7" class="muted small">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';
    
    sb.rpc('get_ref_tree_limited', { p_ref_code: refCode, p_max_level: 100 })
      .then(function({ data, error }) {
        if (error) {
          tbody.innerHTML = '<tr><td colspan="7" class="small" style="color:#b91c1c">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
          return;
        }
        
        if (!data || data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="muted small">–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</td></tr>';
          return;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        tbody.innerHTML = '';
        data.forEach(function(row) {
          var tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row.level}</td>
            <td><code>${row.user_id}</code></td>
            <td>${row.email || '‚Äî'}</td>
            <td>${row.phone || '‚Äî'}</td>
            <td class="right">${(row.balance_cents/100).toFixed(2)} USDT</td>
            <td>${row.ref_code || '‚Äî'}</td>
            <td>${new Date(row.created_at).toLocaleDateString()}</td>
          `;
          tbody.appendChild(tr);
        });
      });
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫ –¥–ª—è Super Admin
  function loadWithdrawals() {
    var tbody = document.getElementById('wTable').querySelector('tbody');
    tbody.innerHTML = '<tr><td colspan="12" class="muted small">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';
    
    sb.from('withdrawals').select(`
      id, created_at, amount_cents, fee_cents, network, address, 
      status, txid, note, user_id,
      profiles!inner(email, phone)
    `).order('created_at', { ascending: false }).limit(50)
      .then(function({ data, error }) {
        if (error) {
          tbody.innerHTML = '<tr><td colspan="12" class="small" style="color:#b91c1c">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
          return;
        }
        
        if (!data || data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="12" class="muted small">–ù–µ—Ç –∑–∞—è–≤–æ–∫</td></tr>';
          return;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        tbody.innerHTML = '';
        data.forEach(function(w) {
          var total = (w.amount_cents || 0) + (w.fee_cents || 0);
          var statusClass = w.status === 'paid' ? 'paid' : w.status === 'rejected' ? 'rejected' : 'pending';
          
          var tr = document.createElement('tr');
          tr.innerHTML = `
            <td><code>${w.user_id}</code></td>
            <td>${new Date(w.created_at).toLocaleString()}</td>
            <td>${w.profiles.email || '‚Äî'}</td>
            <td>${w.profiles.phone || '‚Äî'}</td>
            <td class="right">${(w.amount_cents/100).toFixed(2)} USDT</td>
            <td class="right">${(w.fee_cents/100).toFixed(2)} USDT</td>
            <td class="right">${(total/100).toFixed(2)} USDT</td>
            <td>${w.network || '‚Äî'}</td>
            <td><code>${w.address || '‚Äî'}</code></td>
            <td><span class="pill ${statusClass}">${w.status}</span></td>
            <td>${w.txid ? '<code>' + w.txid.slice(0,6) + '‚Ä¶' + w.txid.slice(-4) + '</code>' : (w.note || '‚Äî')}</td>
            <td>
              ${w.status === 'pending' ? 
                '<button class="btn ok small" onclick="processWithdrawal(\'pay\', \'' + w.id + '\')">–û–ø–ª–∞—Ç–∏—Ç—å</button>' +
                '<button class="btn bad small" onclick="processWithdrawal(\'reject\', \'' + w.id + '\')">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>' : 
                '<span class="muted small">‚Äî</span>'}
            </td>
          `;
          tbody.appendChild(tr);
        });
      });
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è Super Admin
  function loadUsers() {
    var tbody = document.getElementById('uTable').querySelector('tbody');
    tbody.innerHTML = '<tr><td colspan="6" class="muted small">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>';
    
    sb.from('profiles').select('user_id, created_at, email, phone, ref_code, balance_cents')
      .order('created_at', { ascending: false }).limit(100)
      .then(function({ data, error }) {
        if (error) {
          tbody.innerHTML = '<tr><td colspan="6" class="small" style="color:#b91c1c">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</td></tr>';
          return;
        }
        
        if (!data || data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="muted small">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td></tr>';
          return;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        tbody.innerHTML = '';
        data.forEach(function(u) {
          var tr = document.createElement('tr');
          tr.innerHTML = `
            <td><code>${u.user_id}</code></td>
            <td>${new Date(u.created_at).toLocaleString()}</td>
            <td>${u.email || '‚Äî'}</td>
            <td>${u.phone || '‚Äî'}</td>
            <td class="right">${(u.balance_cents/100).toFixed(2)} USDT</td>
            <td>${u.ref_code || '‚Äî'}</td>
          `;
          tbody.appendChild(tr);
        });
      });
  }
});

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–æ–∫
function processWithdrawal(action, withdrawalId) {
  if (action === 'pay') {
    var txid = prompt('–í–≤–µ–¥–∏—Ç–µ TXID:') || null;
    window.sb.rpc('admin_pay_withdrawal_rpc', { p_id: withdrawalId, p_txid: txid })
      .then(function(result) {
        if (result.error) alert('–û—à–∏–±–∫–∞: ' + result.error.message);
        else {
          alert('–ó–∞—è–≤–∫–∞ –æ–ø–ª–∞—á–µ–Ω–∞');
          location.reload();
        }
      });
  } else if (action === 'reject') {
    if (confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É?')) {
      window.sb.rpc('admin_reject_withdrawal_rpc', { p_id: withdrawalId })
        .then(function(result) {
          if (result.error) alert('–û—à–∏–±–∫–∞: ' + result.error.message);
          else {
            alert('–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
            location.reload();
          }
        });
    }
  }
}
</script>
</body>
</html>
